<?xml version="1.0" standalone="no"?>

<kickstart>


	<description>
	IPOP roll 
	</description>

	<copyright>
	Copyright (c) 2000 - 2012 The Regents of the University of California.
	All rights reserved. Rocks(r) v5.5/v6.0 www.rocksclusters.org
	</copyright>

	<changelog>
	</changelog>

	<!-- ejabberd prerequisites -->
	<package>readline</package>
	<package>readline-devel</package>
	<package>libyaml</package>
	<package>libyaml-devel</package>
	<package>ipop-erlang</package>

	<package>ipop-ejabberd</package>

	<package>ipop-turn</package>

<post>

/usr/sbin/useradd -s /sbin/nologin -d /var/lib/ejabberd -M -c "Ejabberd XMPP user" ejabberd 
/sbin/chkconfig --add ejabberd
/sbin/chkconfig --add turnserver

/opt/ipop/ejabberd/bin/initEjabberd
/opt/ipop/turn/sbin/updateConf
/opt/ipop/bin/updateConfJson

rocks remove firewall host=localhost A40-WWW-PUBLIC-LAN
rocks add firewall host=localhost rulename=A40-WWW-PUBLIC-LAN network=public service="www" protocol="tcp" action="ACCEPT" chain="INPUT" flags="-m state --state NEW"
rocks sync host firewall localhost

</post>

</kickstart>
